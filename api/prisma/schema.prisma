// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output = "../../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Trip {
  id Int @default(autoincrement()) @id
  shipId Int @map("ship_id")
  ship Ship @relation(fields: [shipId], references: [id])
  shippingLineId Int @map("shipping_line_id")
  shippingLine ShippingLine @relation(fields: [shippingLineId], references: [id])
  srcPortId Int @map("src_port_id")
  srcPort Port @relation("srcPort", fields: [srcPortId], references: [id])
  destPortId Int @map("dest_port_id")
  destPort Port @relation("destPort", fields: [destPortId], references: [id])

  departureDate DateTime @map("departure_date")
  referenceNo String @map("reference_number")
  seatSelection Boolean @map("seat_selection") @default(false)
  availableVehicleCapacity Int @map("available_vehicle_capacity")
  vehicleCapacity Int @map("vehicle_capacity")
  bookingStartDate DateTime @map("booking_start_date")
  bookingCutOffDate DateTime @map("booking_cut_off_date")

  passengers BookingPassenger[]
  vehicles BookingVehicle[]
  notifications Notification[]
  availableCabins TripCabin[]
  availableVehicleTypes TripVehicleType[]

  @@map("trip")
}

model TripVehicleType {
  tripId Int @map("trip_id")
  trip Trip @relation(fields: [tripId], references: [id])
  vehicleTypeId Int @map("vehicle_type_id")
  vehicleType VehicleType @relation(fields: [vehicleTypeId], references: [id])

  fare Float

  @@map("trip_vehicle_type")
  @@id([tripId, vehicleTypeId])
}

model TripCabin {
  tripId Int @map("trip_id")
  trip Trip @relation(fields: [tripId], references: [id])
  cabinId Int @map("cabin_id")
  cabin Cabin @relation(fields: [cabinId], references: [id])
  seatPlanId Int? @map("seat_plan_id")
  seatPlan SeatPlan? @relation(fields: [seatPlanId], references: [id])

  availablePassengerCapacity Int @map("available_passenger_capacity")
  passengerCapacity Int @map("passenger_capacity")
  adultFare Float @map("adult_fare")

  @@map("trip_cabin")
  @@id([tripId, cabinId])
}

model Ship {
  id Int @default(autoincrement()) @id
  shippingLineId Int @map("shipping_line_id")
  shippingLine ShippingLine @relation(fields: [shippingLineId], references: [id])

  name String
  recommendedVehicleCapacity Int @map("recommended_vehicle_capacity")

  cabins Cabin[]
  trips Trip[]
  schedules ShippingLineSchedule[]

  @@map("ship")
}

model Cabin {
  id Int @default(autoincrement()) @id
  shipId Int @map("ship_id")
  ship Ship @relation(fields: [shipId], references: [id])
  cabinTypeId Int @map("cabin_type_id")
  cabinType CabinType @relation(fields: [cabinTypeId], references: [id])
  defaultSeatPlanId Int? @map("default_seat_plan_id")
  defaultSeatPlan SeatPlan? @relation(fields: [defaultSeatPlanId], references: [id])

  name String
  recommendedPassengerCapacity Int @map("recommended_passenger_capacity")

  tripSpecificInfo TripCabin[]
  schedules ShippingLineScheduleRate[]
  bookings BookingPassenger[]

  @@map("cabin")
}

model SeatPlan {
  id Int @default(autoincrement()) @id
  shippingLineId Int @map("shipping_line_id")
  shippingLine ShippingLine @relation(fields: [shippingLineId], references: [id])

  name String
  rowCount Int @map("row_count")
  columnCount Int @map("column_count")

  seats Seat[]
  trips TripCabin[]
  cabins Cabin[]

  @@map("seat_plan")
}

model Seat {
  id Int @default(autoincrement()) @id
  seatPlanId Int @map("seat_plan_id")
  seatPlan SeatPlan @relation(fields: [seatPlanId], references: [id])
  seatTypeId Int @map("seat_type_id")
  seatType SeatType @relation(fields: [seatTypeId], references: [id])

  name String
  row Int
  column Int

  bookingPassengers BookingPassenger[]

  @@map("seat")
}

model ShippingLine {
  id Int @default(autoincrement()) @id

  name String

  trips Trip[]
  ships Ship[]
  schedules ShippingLineSchedule[]
  cabinTypes CabinType[]
  seatTypes SeatType[]
  seatPlans SeatPlan[]
  accounts Account[]

  @@map("shipping_line")
}

model ShippingLineSchedule {
  id Int @default(autoincrement()) @id
  shippingLineId Int @map("shipping_line_id")
  shippingLine ShippingLine @relation(fields: [shippingLineId], references: [id])
  srcPortId Int @map("src_port_id")
  srcPort Port @relation("srcPort", fields: [srcPortId], references: [id])
  destPortId Int @map("dest_port_id")
  destPort Port @relation("destPort", fields: [destPortId], references: [id])
  shipId Int @map("ship_id")
  ship Ship @relation(fields: [shipId], references: [id])

  name String
  departureHour Int @map("departure_hour")
  departureMinute Int @map("departure_minute")
  daysBeforeBookingStart Int @map("days_before_booking_start")
  daysBeforeBookingCutOff Int @map("days_before_booking_cut_off")

  rates ShippingLineScheduleRate[]

  @@map("shipping_line_schedule")
}

model ShippingLineScheduleRate {
  id Int @default(autoincrement()) @id
  scheduleId Int @map("schedule_id")
  schedule ShippingLineSchedule @relation(fields: [scheduleId], references: [id])
  cabinId Int? @map("cabin_id")
  cabin Cabin? @relation(fields: [cabinId], references: [id])
  vehicleTypeId Int? @map("vehicle_type_id")
  vehicleType VehicleType? @relation(fields: [vehicleTypeId], references: [id])

  fare Float

  @@map("shipping_line_schedule_rate")
}


model Port {
  id Int @default(autoincrement()) @id

  name String
  code String

  tripsSrc Trip[] @relation("srcPort")
  tripsDest Trip[] @relation("destPort")
  schedulesSrc ShippingLineSchedule[] @relation("srcPort")
  schedulesDest ShippingLineSchedule[] @relation("destPort")

  @@map("port")
}

model Booking {
  id String @id
  accountId String? @map("account_id")
  account Account? @relation(fields: [accountId], references: [id])

  referenceNo String @map("reference_no")
  status String
  totalPrice Float @map("total_price")
  bookingType String @map("booking_type")
  createdAt DateTime @map("created_at")

  passengers BookingPassenger[]
  vehicles BookingVehicle[]
  paymentItems PaymentItem[]

  @@map("booking")
}

model BookingPassenger {
  id Int @default(autoincrement()) @id
  bookingId String @map("booking_id")
  booking Booking @relation(fields: [bookingId], references: [id])
  tripId Int @map("trip_id")
  trip Trip @relation(fields: [tripId], references: [id])
  passengerId Int @map("passenger_id")
  passenger Passenger @relation(fields: [passengerId], references: [id])
  cabinId Int @map("cabin_id")
  cabin Cabin @relation(fields: [cabinId], references: [id])
  seatId Int? @map("seat_id")
  seat Seat? @relation(fields: [seatId], references: [id])

  meal String?
  totalPrice Float @map("total_price")
  checkInDate DateTime? @map("check_in_date")

  paymentItems PaymentItem[]

  @@map("booking_passenger")
}

model Passenger {
  id Int @default(autoincrement()) @id
  buddyId Int? @map("buddy_id")
  buddy Passenger? @relation("PassengerBuddies", fields: [buddyId], references: [id])
  accountId String? @map("account_id")
  account Account?

  firstName String @map("first_name")
  lastName String @map("last_name")
  occupation String
  sex String
  civilStatus String @map("civil_status")
  birthday DateTime
  address String
  nationality String
  discountType String? @map("discount_type")

  buddies Passenger[] @relation("PassengerBuddies")
  bookings BookingPassenger[]

  @@map("passenger")
}

model BookingVehicle {
  id Int @default(autoincrement()) @id
  bookingId String @map("booking_id")
  booking Booking @relation(fields: [bookingId], references: [id])
  tripId Int @map("trip_id")
  trip Trip @relation(fields: [tripId], references: [id])
  vehicleId Int @map("vehicle_id")
  vehicle Vehicle @relation(fields: [vehicleId], references: [id])

  totalPrice Float @map("total_price")
  checkInDate DateTime? @map("check_in_date")

  paymentItems PaymentItem[]

  @@map("booking_vehicle")
}

model Vehicle {
  id Int @default(autoincrement()) @id
  accountId String? @map("account_id")
  account Account? @relation(fields: [accountId], references: [id])
  vehicleTypeId Int @map("vehicle_type_id")
  vehicleType VehicleType @relation(fields: [vehicleTypeId], references: [id])

  plateNo String @map("plate_number")
  modelName String @map("model_name")
  modelYear Int @map("model_year")
  officialReceiptUrl String @map("official_receipt_url")
  certificateOfRegistrationUrl String @map("certificate_of_registration_url")

  bookings BookingVehicle[]

  @@map("vehicle")
}

model TempBooking {
  id Int @default(autoincrement()) @id
  accountId String? @map("account_id")
  account Account? @relation(fields: [accountId], references: [id])

  totalPrice Float @map("total_price")
  bookingType String @map("booking_type")
  paymentReference String? @map("payment_reference")
  createdAt DateTime @map("created_at")

  passengersJson Json @map("passengers_json")
  vehiclesJson Json @map("vehicles_json")
  paymentItemsJson Json @map("payment_items_json")

  @@map("temp_booking")
}

model Account {
  id String @id
  passengerId Int? @map("passenger_id") @unique
  passenger Passenger? @relation(fields: [passengerId], references: [id])
  shippingLineId Int? @map("shipping_line_id")
  shippingLine ShippingLine? @relation(fields: [shippingLineId], references: [id])

  email String
  role String

  bookings Booking[]
  vehicles Vehicle[]
  tempBookings TempBooking[]
  notifications AccountNotification[]

  @@map("account")
}

model CabinType {
  id Int @default(autoincrement()) @id
  shippingLineId Int @map("shipping_line_id")
  shippingLine ShippingLine @relation(fields: [shippingLineId], references: [id])

  name String
  description String

  cabins Cabin[]

  @@map("cabin_type")
}

model SeatType {
  id Int @default(autoincrement()) @id
  shippingLineId Int @map("shipping_line_id")
  shippingLine ShippingLine @relation(fields: [shippingLineId], references: [id])

  name String
  description String

  seats Seat[]

  @@map("seat_type")
}

model Notification {
  id Int @default(autoincrement()) @id
  tripId Int? @map("trip_id")
  trip Trip? @relation(fields: [tripId], references: [id])

  subject String
  body String
  dateCreated DateTime @map("date_created")

  accountNotifications AccountNotification[]

  @@map("notification")
}

model AccountNotification {
  accountId String @map("account_id")
  account Account @relation(fields: [accountId], references: [id])
  notificationId Int @map("notification_id")
  notification Notification @relation(fields: [notificationId], references: [id])

  isRead Boolean @map("is_read")

  @@map("account_notification")
  @@id([accountId, notificationId])
}

model VehicleType {
  id Int @default(autoincrement()) @id

  name String
  description String

  trips TripVehicleType[]
  schedules ShippingLineScheduleRate[]
  vehicles Vehicle[]

  @@map("vehicle_type")
}

model PaymentItem {
  id Int @default(autoincrement()) @id
  bookingId String @map("booking_id")
  booking Booking @relation(fields: [bookingId], references: [id])

  price Float
  description String

  bookingPassengerId Int? @map("booking_passenger_id")
  bookingPassenger BookingPassenger? @relation(fields: [bookingPassengerId], references: [id])
  bookingVehicleId Int? @map("booking_vehicle_id")
  bookingVehicle BookingVehicle? @relation(fields: [bookingVehicleId], references: [id])

  @@map("payment_item")
}
