// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output = "../../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Seat {
  id Int @default(autoincrement()) @id
  cabinId Int
  cabin Cabin @relation(fields: [cabinId], references: [id])
  name String
  rowNumber Int
  columnNumber Int
  type String
  bookingPassengers BookingPassenger[]
}

model Cabin {
  id Int @default(autoincrement()) @id
  shipId Int
  ship Ship @relation(fields: [shipId], references: [id])
  type String
  name String
  passengerCapacity Int
  numOfRows Int
  numOfColumns Int
  seats Seat[]
}

model Ship {
  id Int @default(autoincrement()) @id
  name String
  passengerCapacity Int
  vehicleCapacity Int
  cabins Cabin[]
  trips Trip[]
}

model Trip {
  id Int @default(autoincrement()) @id
  shipId Int
  ship Ship @relation(fields: [shipId], references: [id])
  shippingLineId Int
  shippingLine ShippingLine @relation(fields: [shippingLineId], references: [id])
  srcPortId Int
  srcPort Port @relation("srcPort", fields: [srcPortId], references: [id])
  destPortId Int
  destPort Port @relation("destPort", fields: [destPortId], references: [id])
  departureDate DateTime
  baseFare Float
  referenceNo String
  bookings Booking[]
}

model ShippingLine {
  id Int @default(autoincrement()) @id
  name String
  trips Trip[]
}

model Port {
  id Int @default(autoincrement()) @id
  tripsSrc Trip[] @relation("srcPort")
  tripsDest Trip[] @relation("destPort")
  name String
}

model Booking {
  id Int @default(autoincrement()) @id
  tripId Int
  trip Trip @relation(fields: [tripId], references: [id])
  totalPrice Float
  paymentReference String
  referenceNo String
  passengers BookingPassenger[]
  vehicles BookingVehicle[]
}

model Passenger {
  id Int @default(autoincrement()) @id
  firstName String
  lastName String
  occupation String
  sex String
  civilStatus String
  birthday DateTime
  address String
  nationality String
  buddyId Int?
  buddy Passenger? @relation("PassengerBuddies", fields: [buddyId], references: [id])
  buddies Passenger[] @relation("PassengerBuddies")
  bookings BookingPassenger[]
  vehicles PassengerVehicle[]
}

model BookingPassenger {
  id Int @default(autoincrement()) @id
  bookingId Int
  booking Booking @relation(fields: [bookingId], references: [id])
  passengerId Int
  passenger Passenger @relation(fields: [passengerId], references: [id])
  seatId Int
  seat Seat @relation(fields: [seatId], references: [id])
  meal String
  totalPrice Float
  referenceNo String
  checkInDate DateTime?
}

model BookingVehicle {
  id Int @default(autoincrement()) @id
  bookingId Int
  booking Booking @relation(fields: [bookingId], references: [id])
  vehicleId Int
  vehicle PassengerVehicle @relation(fields: [vehicleId], references: [id])
  totalPrice Float
}

model PassengerVehicle {
  id Int @default(autoincrement()) @id
  passengerId Int
  passenger Passenger @relation(fields: [passengerId], references: [id])
  plateNo String
  modelName String
  modelYear Int
  modelBody String
  officialReceiptUrl String
  certificateOfRegistrationUrl String
  bookings BookingVehicle[]
}